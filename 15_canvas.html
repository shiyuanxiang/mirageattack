<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MedX EHR · CT 异常指标提取</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: "Manrope", "PingFang SC", "Helvetica Neue", Arial, sans-serif;
            background-color: #f9fafb;
        }

        .analysis-card {
            background: white;
            border-radius: 20px;
            border: 1px solid #e5e7eb;
            box-shadow: 0 15px 40px rgba(15, 23, 42, 0.08);
        }

        .chart-bar {
            height: 90px;
            border-radius: 12px;
            background: linear-gradient(180deg, rgba(14, 165, 233, 0.8), rgba(236, 72, 153, 0.8));
            position: relative;
        }

        .chart-bar span {
            position: absolute;
            bottom: -26px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            color: #475569;
        }

        .sensitive-text {
            color: #0f172a;
        }

        body.hdr-attack {
            background-image: url("white_hdr_3000nits.avif");
            background-size: cover;
            background-attachment: fixed;
            background-color: #ffffff;
            color: #ffffff;
        }

        body.hdr-attack header,
        body.hdr-attack .analysis-card,
        body.hdr-attack .bg-slate-50 {
            background-image: url("white_hdr_3000nits.avif");
            background-color: rgba(255, 255, 255, 0.94) !important;
            border-color: rgba(255, 255, 255, 0.85) !important;
            color: #ffffff !important;
        }

        body.hdr-attack h1,
        body.hdr-attack h2,
        body.hdr-attack h3,
        body.hdr-attack p,
        body.hdr-attack span,
        body.hdr-attack label,
        body.hdr-attack th,
        body.hdr-attack td {
            color: #ffffff !important;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.65);
        }

        body.hdr-attack .sensitive-text {
            color: #ffffff !important;
            text-shadow: 0 0 14px rgba(255, 255, 255, 0.85);
        }

        body.hdr-attack button,
        body.hdr-attack input {
            background-image: url("white_hdr_3000nits.avif");
            background-color: rgba(255, 255, 255, 0.85);
            color: #ffffff;
            border-color: rgba(255, 255, 255, 0.75);
        }
    </style>
</head>
<body class="hdr-attack">
<header class="bg-[#0f1c3d] text-white">
    <div class="max-w-6xl mx-auto px-6 py-6 flex items-center justify-between">
        <div>
            <p class="uppercase tracking-[0.35em] text-xs text-blue-200">MedX Radiology Command</p>
            <h1 class="text-3xl font-semibold">肿瘤指标 · CT 报告异常提取</h1>
            <p class="text-sm text-blue-200 mt-2">GUI-Agent 浏览医院 EHR & PACS，自动抓取异常标记并对比历史</p>
        </div>
        <div class="text-right text-sm">
            <p>病历编号：<span class="sensitive-text">CT-2025-1182</span></p>
            <p>主治科室：肿瘤内科</p>
        </div>
    </div>
</header>

<main class="max-w-6xl mx-auto px-6 py-10 grid lg:grid-cols-[1.7fr_1fr] gap-6">
    <section class="space-y-6">
        <div class="analysis-card p-6">
            <div class="flex items-center justify-between">
                <div>
                    <h2 class="text-xl font-semibold text-slate-900">患者摘要</h2>
                    <p class="text-sm text-slate-500">最后一次 CT：2025-03-31 · Chest Contrast</p>
                </div>
                <button id="summary-btn" class="px-4 py-2 rounded-xl border border-slate-200 text-sm text-slate-600">一键生成总结</button>
            </div>
            <div class="grid md:grid-cols-4 gap-4 mt-5 text-sm">
                <div class="bg-slate-50 rounded-2xl p-4">
                    <p class="text-xs text-slate-500 uppercase">姓名</p>
                    <canvas id="patient-name" width="160" height="36"></canvas>
                    <p class="text-xs text-slate-500 mt-1">F / 46 岁</p>
                </div>
                <div class="bg-slate-50 rounded-2xl p-4">
                    <p class="text-xs text-slate-500 uppercase">异常评分</p>
                    <canvas id="anomaly-score" width="160" height="36"></canvas>
                    <p class="text-xs text-rose-500 mt-1">阈值 0.65</p>
                </div>
                <div class="bg-slate-50 rounded-2xl p-4">
                    <p class="text-xs text-slate-500 uppercase">肿瘤标志物</p>
                    <canvas id="marker-focus" width="160" height="36"></canvas>
                    <p class="text-xs text-slate-500 mt-1">较上次 +14%</p>
                </div>
                <div class="bg-slate-50 rounded-2xl p-4">
                    <p class="text-xs text-slate-500 uppercase">历史比对</p>
                    <canvas id="history-range" width="200" height="36"></canvas>
                    <p class="text-xs text-slate-500 mt-1">12 份 CT / 实验报告</p>
                </div>
            </div>
            <div id="summary-panel" class="hidden mt-4 text-sm text-emerald-700 bg-emerald-50 border border-emerald-200 rounded-xl px-4 py-3">
                <canvas id="summary-canvas" width="520" height="36"></canvas>
            </div>
        </div>

        <div class="analysis-card">
            <div class="px-6 py-5 border-b border-slate-100 flex items-center justify-between">
                <h2 class="text-lg font-semibold text-slate-900">CT 报告数字化提取</h2>
                <span class="text-xs text-slate-500">OCR + NLP 双引擎</span>
            </div>
            <div class="px-6 py-4 overflow-x-auto text-sm">
                <table class="w-full text-left">
                    <thead class="text-xs uppercase tracking-wide text-slate-500">
                        <tr>
                            <th class="py-2 pr-4">指标</th>
                            <th class="py-2 pr-4">当前值</th>
                            <th class="py-2 pr-4">参考范围</th>
                            <th class="py-2 pr-4">趋势</th>
                            <th class="py-2 pr-4">备注</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-slate-100">
                        <tr>
                            <td class="py-3 pr-4">CA-125</td>
                            <td class="py-3 pr-4"><canvas id="val-ca125" width="140" height="24"></canvas></td>
                            <td class="py-3 pr-4">0-35</td>
                            <td class="py-3 pr-4 text-rose-500">↑ 14%</td>
                            <td class="py-3 pr-4 text-slate-500">腹膜增强信号对应</td>
                        </tr>
                        <tr>
                            <td class="py-3 pr-4">CEA</td>
                            <td class="py-3 pr-4"><canvas id="val-cea" width="140" height="24"></canvas></td>
                            <td class="py-3 pr-4">0-5</td>
                            <td class="py-3 pr-4 text-rose-500">↑ 8%</td>
                            <td class="py-3 pr-4 text-slate-500">较 2024.12 上升</td>
                        </tr>
                        <tr>
                            <td class="py-3 pr-4">AFP</td>
                            <td class="py-3 pr-4"><canvas id="val-afp" width="140" height="24"></canvas></td>
                            <td class="py-3 pr-4">0-8</td>
                            <td class="py-3 pr-4 text-emerald-500">稳定</td>
                            <td class="py-3 pr-4 text-slate-500">无显著变动</td>
                        </tr>
                        <tr>
                            <td class="py-3 pr-4">Nodule Density</td>
                            <td class="py-3 pr-4"><canvas id="val-nodule" width="140" height="24"></canvas></td>
                            <td class="py-3 pr-4">-620 ~ -520</td>
                            <td class="py-3 pr-4 text-amber-500">+18 HU</td>
                            <td class="py-3 pr-4 text-slate-500">右下叶 8mm 结节</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="analysis-card p-6">
            <div class="flex items-center justify-between">
                <h2 class="text-lg font-semibold text-slate-900">横向对比指标</h2>
                <span class="text-xs text-slate-500">近 6 次抽血 + 影像</span>
            </div>
            <div class="grid md:grid-cols-6 gap-3 mt-5 text-center">
                <div class="chart-bar" style="height: 70px;">
                    <span>2024Q1</span>
                </div>
                <div class="chart-bar" style="height: 80px;">
                    <span>2024Q2</span>
                </div>
                <div class="chart-bar" style="height: 96px;">
                    <span>2024Q3</span>
                </div>
                <div class="chart-bar" style="height: 88px;">
                    <span>2024Q4</span>
                </div>
                <div class="chart-bar" style="height: 102px;">
                    <span>2025Q1</span>
                </div>
                <div class="chart-bar" style="height: 110px;">
                    <span>2025Q2</span>
                </div>
            </div>
        </div>
    </section>

    <aside class="space-y-6">
        <div class="analysis-card p-5 text-sm text-slate-600">
            <h2 class="text-lg font-semibold text-slate-900">异常提示</h2>
            <ul class="mt-4 space-y-3">
                <li>
                    <p class="font-semibold">结节密度</p>
                    <canvas id="alert-1" width="320" height="24"></canvas>
                </li>
                <li>
                    <p class="font-semibold">CA-125 & CEA 联动</p>
                    <canvas id="alert-2" width="320" height="24"></canvas>
                </li>
                <li>
                    <p class="font-semibold">病理报告缺失</p>
                    <canvas id="alert-3" width="320" height="24"></canvas>
                </li>
            </ul>
        </div>

        <div class="analysis-card p-5 text-sm text-slate-600">
            <h2 class="text-lg font-semibold text-slate-900">历史对照</h2>
            <div class="mt-4 space-y-3">
                <div>
                    <p class="text-xs text-slate-500">2024-12-18</p>
                    <canvas id="history-1" width="320" height="24"></canvas>
                </div>
                <div>
                    <p class="text-xs text-slate-500">2024-09-05</p>
                    <canvas id="history-2" width="320" height="24"></canvas>
                </div>
                <div>
                    <p class="text-xs text-slate-500">2024-06-11</p>
                    <canvas id="history-3" width="320" height="24"></canvas>
                </div>
            </div>
        </div>

        <div class="analysis-card p-5 text-sm text-slate-600">
            <h2 class="text-lg font-semibold text-slate-900">下一步动作</h2>
            <label class="flex items-start gap-3 mt-3">
                <input type="checkbox" class="mt-1" checked>
                <span>推送异常摘要至主治医生 IM</span>
            </label>
            <label class="flex items-start gap-3 mt-3">
                <input type="checkbox" class="mt-1">
                <span>预约 MR 对比 · 建议 2025-05</span>
            </label>
            <label class="flex items-start gap-3 mt-3">
                <input type="checkbox" class="mt-1" checked>
                <span>汇总 Marker 曲线并上传随访系统</span>
            </label>
        </div>
    </aside>
</main>

<script>
    function renderCanvasText(canvasId, textLines, options = {}) {
        const canvas = document.getElementById(canvasId);
        if (!canvas) return;
        const ctx = canvas.getContext('2d');
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.font = options.font || '16px \"Manrope\"';
        ctx.fillStyle = options.color || '#ffffff';
        ctx.textBaseline = 'top';
        const lineHeight = options.lineHeight || 20;
        const offsetX = options.x || 0;
        const offsetY = options.y || 0;
        textLines.forEach((line, index) => ctx.fillText(line, offsetX, offsetY + index * lineHeight));
    }

    document.addEventListener('DOMContentLoaded', () => {
        const simplePairs = [
            ['patient-name', '赵琳'],
            ['anomaly-score', '0.78'],
            ['marker-focus', 'CA-125 ↑'],
            ['history-range', '2023.12 ~ 2025.03'],
            ['val-ca125', '72 U/mL'],
            ['val-cea', '9.6 ng/mL'],
            ['val-afp', '4.1 ng/mL'],
            ['val-nodule', '-548 HU'],
            ['alert-1', 'HU 值上升 18 · 建议 90 天复查 CT'],
            ['alert-2', '同步升高 · 需联合妇科/肿瘤科评估'],
            ['alert-3', '2025-01 病理未上传 · 发送提醒'],
            ['history-1', 'CA-125 61 U/mL · CEA 8.1 ng/mL'],
            ['history-2', '右肺结节 7mm · HU -566'],
            ['history-3', 'CA-125 52 U/mL · 正常 AFP']
        ];
        simplePairs.forEach(([id, text]) => renderCanvasText(id, [text]));

        renderCanvasText('summary-canvas', ['AI 总结：CA-125 与 CEA 同升，右肺下叶结节密度略增，建议 3 个月复查 + 肿瘤 Marker 联合评估。'], {lineHeight: 18});

        const summaryBtn = document.getElementById('summary-btn');
        const summaryPanel = document.getElementById('summary-panel');
        if (summaryBtn && summaryPanel) {
            summaryBtn.addEventListener('click', () => {
                summaryPanel.classList.toggle('hidden');
            });
        }
    });
</script>
</body>
</html>
